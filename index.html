<!DOCTYPE html>
<html lang="en"><head>

  <link rel="stylesheet" href="https://unpkg.com/bootstrap-material-design@4.1.1/dist/css/bootstrap-material-design.min.css" integrity="sha384-wXznGJNEXNG1NFsbm0ugrLFMQPWswR3lds2VeinahP8N0zJw9VWSopbjv2x7WCvX" crossorigin="anonymous">

  <script src="https://unpkg.com/popper.js@1.12.6/dist/umd/popper.js" integrity="sha384-fA23ZRQ3G/J53mElWqVJEGJzU0sTs+SvzG8fXVWP+kJQ1lwFAOkcUOysnlKJC33U" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-material-design@4.1.1/dist/js/bootstrap-material-design.js" integrity="sha384-CauSuKpEqAFajSpkdjv3z9t8E7RlpJ1UP0lKM/+NdtSarroVKu069AlsRPKkFBz9" crossorigin="anonymous"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://getbootstrap.com/favicon.ico">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <title>Charism.ai</title>

    <!-- Bootstrap core CSS -->
<!--     <link href="css/bootstrap.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">

    <style type="text/css">/* Chart.js */
  @-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style>
  <style type="text/css">
  .bg-primary { background:  linear-gradient(to top, #ff6666 0%, #ffff66 100%) !important; }
  .bg-secondary { background: #FF5252 !important; }
  .text-primary   { color:  #212121 !important; }
  .text-secondary  { color: #757575 !important; }
  </style>

  <script type="text/javascript" src="js/data.js"></script>

<!--   <div class="navbar navbar-dark bg-dark box-shadow">
        <div class="container d-flex" style="text-align: center; color: #212121">
            <strong>Charism.ai</strong>
        </div>
      </div> -->
</head>

  <body class=navbar-fixed-bottom">
<!--     <nav class="container-fluid bg-primary">
        <a class="col-sm-12 navbar-brand text-center text-dark bg-primary" href="#">Charism.ai</a>
    </nav>
 -->
     <script type="text/javascript">
      function reportDownload() {
        console.log("report downloading...");
        var element = document.getElementById('download2');
        html2pdf(element);
      }
    </script>

    <div class="container-fluid bg-primary">
      <div class="row">

        <main role="main" class="col-md-12 ml-sm-auto col-lg-12 pt-3 px-4"><div style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;" class="chartjs-size-monitor"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
          <div class=row>
            <div class="col-md-6">
              <h1 class="h2 text-center">Video</h1>
              <div class="border-top border-primary text-center">
                <div class="row flex-md-nowrap container-fluid text-center">
                    <video id="recorded" class="p-1" loop controls></video>
                    <video id="gum" class="p-1" autoplay muted></video>
                </div>
                 <div class="text-center">
                   <div class="btn-group" role="group">
                    <button class="btn btn-primary active" type="submit" id="record" disabled>Record</button>
                    <button class="btn btn-primary active" type="submit" id="play" disabled>Replay</button>
                    <button class="btn btn-primary active" type="submit" id="download" disabled>Download</button>
                  </div>
                 </div>
               </div>
              <h1 class="h2 text-center">Transcript</h1>
              <div class="border-top border-primary">
                <span class="bmd-form-group">
                  <p class="h4" id="entities"></p>
                </span>
                <span class="bmd-form-group">
                  <div>
                    <p class="h4" id="voiceTranscript"></p>
                  </div>
                </span>
              </div>
<!--               <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                  <button class="btn btn-sm btn-outline-secondary">Recommendations</button>
                  <button class="btn btn-sm btn-outline-secondary">Share</button>
                </div>
              </div> -->
            </div>
            <div class="col-md-6">
              <div class="container-fluid">
                <h1 class="h2 text-center">Analysis</h1>
                <div class="border-top border-primary container-fluid" id="Plot-Container">
                  <div class="" id="emotion"></div>
                  <div class="" id="energy"></div>
                  <div class="" id="volume"></div>
                  <div class="" id="rpy"></div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script src="js/main2.js"></script>
    <script src="js/soundmeter.js"></script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-3.js"></script>
    <script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.js"></script>

    <!-- Icons -->
    <script src="js/feather.js"></script>
    <script>
      feather.replace()
    </script>

    <!-- Graphs -->
    <script src="js/Chart.js"></script>
    <script>
      // dataEm = []; //each trace
      // for(var i = 0; i < xEm.length; i++) {
      //   dataEm[i] = {
      //     x: xEm[i],
      //     y: yEm[i],
      //     type: "scatter"
      //   }
      // }
      //---------------------------------------

            var mongoSettings = {
        "async": true,
        "crossDomain": true,
        "url": "https://api.mlab.com/api/1/databases/th18/collections/analyses?apiKey=keHd4eKyrvVivRJk-LlGKbVlAwVezEtE",
        "method": "GET",
        "headers": {
          "content-type": "application/json; charset=utf-8",
        }
      };

      var data = null;
      var numFrames = 10;

      var sentX = [];
      var sentY = [];

      var rpyX = [];
      var rollY = [];
      var pitchY = [];
      var yawY = [];

      var emoCount = [0,0,0,0,0,0,0,0];

      var emoLabels = ["anger","contempt","disgust","fear","happiness","neutral","sadness","surprise"];

      for (var i = 0; i < numFrames; i++) {
          sentX.push(i);
      }
      rpyX = sentX;

      var ultimateColors = [
  ['rgb(56, 75, 126)', 'rgb(18, 36, 37)', 'rgb(34, 53, 101)', 'rgb(36, 55, 57)', 'rgb(6, 4, 4)','rgb(129, 180, 179)', 'rgb(124, 103, 37)','rgb(177, 127, 38)'],
  ['rgb(177, 127, 38)', 'rgb(205, 152, 36)', 'rgb(99, 79, 37)', 'rgb(129, 180, 179)', 'rgb(124, 103, 37)','rgb(56, 75, 126)', 'rgb(18, 36, 37)', 'rgb(34, 53, 101)'],
  ['rgb(33, 75, 99)', 'rgb(79, 129, 102)', 'rgb(151, 179, 100)', 'rgb(175, 49, 35)', 'rgb(36, 73, 147)','rgb(205, 152, 36)', 'rgb(99, 79, 37)', 'rgb(129, 180, 179)'],
  ['rgb(146, 123, 21)', 'rgb(177, 180, 34)', 'rgb(206, 206, 40)', 'rgb(175, 51, 21)', 'rgb(35, 36, 21)','rgb(33, 75, 99)', 'rgb(79, 129, 102)', 'rgb(151, 179, 100)']
];

    var pieColors = ultimateColors.sort(() => .5 - Math.random()).slice(0,emoLabels.length);


     var entities = [];

      function getData () {

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = false;

        xhr.addEventListener("readystatechange", function () {
          console.log("got response");
          if (this.readyState === 4) {
            console.log(this.response);
            data = this.response;
            var length = data.length;
            console.log(length);
            var i = numFrames;

            while (i > 0 && typeof data[length-i] != 'undefined') {
              sentY.unshift(data[length-i]["sentiment"]);
                if(typeof data[length-i]["expression"] != 'undefined'){
                  for(var j = 0; j < emoLabels.length;j++){
                    if (data[length-i]["expression"] == emoLabels[j]) {
                      emoCount[j] += 1;
                      continue;
                    } 
                  }
                }
              rollY.unshift(data[length-i]["roll"]);
              pitchY.unshift(data[length-i]["pitch"]);
              yawY.unshift(data[length-i]["yaw"]);

              // if(typeof data[length-i]["keywords"] != 'undefined') {
              //   for(var k=0; k < data[length-i]["keywords"].length; k++) {
              //     entities.push(data[length-i]["keywords"][k]);
              //   }
              //  }
              i -= 1;
            }
            console.log(sentX,sentY);
            dataEn = {
              x: sentX,
              y: sentY,
              type: "scatter"
            }
            dataEm = [{
              values: emoCount,
              labels: emoLabels,
              type: "pie",
               marker: {
                  colors: ultimateColors[Math.floor(Math.random()*ultimateColors.length)]
                }
            }];

            dataRoll = {
              x: rpyX,
              y: rollY,
              type: "scatter",
              name: "Roll"
            }
            dataPitch = {
              x: rpyX,
              y: pitchY,
              type: "scatter",
              name: "Pitch"
            }
            dataYaw = {
              x: rpyX,
              y: yawY,
              type: "scatter",
              name: "Yaw",
              marker: {
                colors: ['rgb(99, 79, 37)', 'rgb(129, 180, 179)', 'rgb(124, 103, 37)']
              }
            }

            var layoutEm = {
              height: 700,
              width: 700
            };
            Plotly.newPlot('energy', [dataEn], {title: "Energy", width: 800, autosize: true,paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'});
            Plotly.newPlot('emotion', dataEm,  {title: "Emotion", width: 800, autosize: true,paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'});
            Plotly.newPlot('rpy', [dataRoll,dataPitch,dataYaw],  {title: "Roll, Pitch, Yaw", width: 800, autosize: true,paper_bgcolor:'rgba(0,0,0,0)',plot_bgcolor:'rgba(0,0,0,0)'});


            var entities = Array.from(new Set(entities));
            document.getElementById("entities").value = "Main Ideas: " + entities; 
          }
        });

        var placeholder = "";

        xhr.open("GET", "https://api.mlab.com/api/1/databases/th18/collections/analyses?apiKey=keHd4eKyrvVivRJk-LlGKbVlAwVezEtE");
        xhr.setRequestHeader("content-type", "application/json; charset=utf-8");
        xhr.responseType = 'json';

        xhr.send(placeholder);

      }
      getData();
      

    </script>

    <script type="text/javascript">
      console.log("volData:",volData);
    </script>

        <script src="css/main.js"></script>
  <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>


    <script type="text/javascript">
      window.addEventListener('resize', function() { Plotly.Plots.resize('emotion'); });
      window.addEventListener('resize', function() { Plotly.Plots.resize('energy'); });
      window.addEventListener('resize', function() { Plotly.Plots.resize('volume'); });
      window.addEventListener('resize', function() { Plotly.Plots.resize('rpy'); });
    </script>


    <script src="js/html2pdf.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  </body>
 
</html>